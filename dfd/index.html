<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DFD GPS Correction Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 2rem; line-height: 1.45; }
    .card { border:1px solid #ddd; border-radius:12px; padding:1.25rem; max-width:900px; }
    label{display:block;margin-top:.5rem;font-size:.9rem} input{width:100%;padding:.5rem}
    .row{display:flex;gap:1rem;flex-wrap:wrap}.row>div{flex:1 1 280px}
    button{margin-top:1rem;padding:.75rem 1rem;border-radius:10px;border:1px solid #333;background:#111;color:#fff;cursor:pointer}
    pre{background:#f7f7f7;padding:.75rem;border-radius:8px;overflow:auto}
  </style>
</head>
<body>
<div class="card">
  <h1>DFD GPS Correction Demo</h1>
  <div class="row">
    <div>
      <label>Latitude (deg) <input id="lat" type="number" value="34.05" step="0.0001"></label>
      <label>Longitude (deg) <input id="lon" type="number" value="-118.25" step="0.0001"></label>
      <label>Height h (m) <input id="h_m" type="number" value="100"></label>
      <label>Elevation (deg) <input id="elev_deg" type="number" value="45"></label>
      <label>Nominal geometric range (m) <input id="range_m" type="number" value="20200000"></label>
    </div>
    <div>
      <label>Temperature (K) <input id="temp_K" type="number" value="293.15"></label>
      <label>Pressure (Pa) <input id="pressure_Pa" type="number" value="101325"></label>
      <label>Relative humidity (0..1) <input id="rh_frac" type="number" value="0.5" step="0.01"></label>
    </div>
  </div>
  <button onclick="run()">Compute DFD Correction</button>
  <h3>Result</h3>
  <pre id="out">Click Compute…</pre>
</div>

<script>
async function run(){
  const p = id => parseFloat(document.getElementById(id).value);
  const payload = {
    lat:p('lat'), lon:p('lon'), h_m:p('h_m'),
    elev_deg:p('elev_deg'), range_m:p('range_m'),
    temp_K:p('temp_K'), pressure_Pa:p('pressure_Pa'), rh_frac:p('rh_frac')
  };
  const out = document.getElementById('out');
  out.textContent = 'Computing…';

  try {
    const res = await fetch('/api/index/dfd-correct', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });

    const text = await res.text();
    let data;
    try { data = JSON.parse(text); } catch { data = { error:text }; }

    if (!res.ok) {
      out.textContent = `Error ${res.status}:\n${JSON.stringify(data, null, 2)}`;
      return;
    }
    out.textContent = JSON.stringify(data, null, 2);
  } catch (err) {
    out.textContent = `Network error:\n${err}`;
  }
}
</script>
</body>
</html>
